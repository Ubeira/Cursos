import { Container, CircularProgress } from '@material-ui/core';
import { useDispatch, useSelector } from 'react-redux';
import React, { useEffect, useState } from 'react';
import queryString from 'query-string';

import { searchMovie } from '../../redux/actions/search';
import { movieResults, isSearchLoading } from '../../redux/selector';
import MovieResult from '../../components/MovieResult';

export default ({ location }) => {
  const dispatch = useDispatch();
  const movies = useSelector((state) => movieResults(state));
  const isLoading = useSelector((state) => isSearchLoading(state));
  const [isLooked, setIsLooked] = useState(false);

  useEffect(() => {
    const { movieName } = queryString.parse(location.search);
    if (movieName && !isLooked) {
      setIsLooked(true);
      dispatch(searchMovie({ movieName }));
    }
  });
  const renderMovies = () => {
    if (movies) {
      const moviesList = movies.map((movie, index) => {
        if (movie.Poster === 'N/A')
          movie.Poster =
            'data:image/jpeg;base64,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';
        return <MovieResult key={index} {...movie} />;
      });

      return moviesList;
    } else if (isLoading) {
      return <CircularProgress size={100} color="primary" />;
    } else {
      return <h1></h1>;
    }
  };
  //Container tiene que devolver algo o dar√° un error molesto
  return <Container>{renderMovies()}</Container>;
};
